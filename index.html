<!DOCTYPE html>
<html>
<head>
  <title>Webex Click to Call Test</title>
  <script src="https://unpkg.com/@webex/calling"></script>
</head>
<body>
  <button id="callBtn">Llamar</button>

  <script>
    const jweToken = "eyJwMnMiOiIwVG8wN2xTd3UyYkdaRFN3MVp1ajZmdyIsInAyYyI6OTgzMiwiYXVkIjoiODA5MDZlMjUtNWE4Yy00ZGFmLThjMzEtNjgxNDBjZDE5MmJjIiwia2lkIjoia21zOi8va21zLWFvcmUud2J4Mi5jb20va2V5cy8xMjJkNDFiNC1hOTk4LTQzOTktOTUyMy1jMmEyZjljNjQ2MTAiLCJpc3MiOiJlOGEzNTI2Mi0wNjI3LTQwZDEtOWIzMS04MmI2YjlhZjM2NTMiLCJjdHkiOiJKV1QiLCJlbmMiOiJBMTkyQ0JDLUhTMzg0IiwiYWxnIjoiUEJFUzItSFMzODQrQTE5MktXIiwianRpIjoiYjZhZmU2ODUtMmM4NC00Yjg1LWI0YzYtOWRhZTllYjhmNGUwIn0.CevPm-TmYvWHfUMmnayqAkDa3eN_Fp7olWS9YRS9JRrKEV9gtP40ZqIxRZGZD2MBvh050guYS_U.LdzvbfpUF69q6i4zRSe8Xw.r11VheuEFe2WP6Wm8I137QpIXQaG_LiZNM2MX1CHCgHZ6FSU4C2URYqLHdIGYnL58trC2C7-4cpS5QJo3OM5ohzN0JDu6va_7z4PeMBpW69qmOxfVlc3hhrcCyixCdM9WvvDfvglafSyk_zL1t6iJAeN1GpjtgTZZJn0lsPoygYjR65Ff1XMXXoucupX_pCWZSSsgphBRJT6MpWO5JZWy1r7R9pLM4GTpsYwwoHVHmkFQz_XteDsO7-a5P8T_EOGqK957ty-VfZImo8BatJaWbiJjs7fxvFEYvw5tjUjYwu_yYP5E5AtstIakzWgcg3yyGTn7qhmK2kjNfdNYhh1waN39g6EI9v4PGRYBWOLgiCD-RAkQTzhypXmwLTYI17xsEHgHUqXbPxHVfgiifQQqJ0Hvcg68bAWNh_59aqRGUyNJqyaofG0g_SE5yWDsHTfy-qyhxWPl7V5Dr3-TYALhya5bYIW-dN-QFJwaL2cPMJWyi6DQT2dhYn6ftnu9o96rH4NSOtR14Fs3szPnmQuayQyvCtFD5OJnrX6xZZRqSMWCMa7cTcPiYoVIjRFf_YysaUiB1g986LwjeIpSkLGQAmydU09hkhhR8fEWaQqrkEy6cGL_jB5_NlvB-ivkgESawg9LIvszoqA3JAEZsjiRS1dhuKLecE5jadeFMKrFjutY-VQlpX6xm9XRCHa3PZspYPf8FZUHH8Y9UDoWSEZeOnsbmzZeqa7Sc4o08kPqbbMPKD-5Dj7yBgPNBPCZCrGg13QNMY2AOaGkblWhSzudA.o5Vq3LYPplzRvGcb-RrKQPub-h81icf2"; // quémalo directo por ahora

    async function initCall() {
      const webexConfig = { 
        config: {}, 
        credentials: { access_token: jweToken }
      };

      const callingClientConfig = {
        serviceData: {
          indicator: `guestcalling`,
          guestName: `Invitado`
        },
        jwe: jweToken,
      };

      const callingConfig = {
        callingClientConfig,
      };

      const calling = await Calling.init({ webexConfig, callingConfig });

      calling.on("ready", async () => {
        await calling.register();
        const callingClient = calling.callingClient;
        const line = Object.values(callingClient.getLines())[0];

        line.on('registered', async () => {
          // Creamos el stream de audio local
          const localAudioStream = await Calling.createMicrophoneStream({ audio: true });

          // Creamos la llamada (click-to-call => sin parámetros en makeCall)
          const call = line.makeCall();
          call.dial({ localAudioStream });
        });

        line.register();
      });
    }

    document.getElementById("callBtn").addEventListener("click", initCall);
  </script>
</body>
</html> 
