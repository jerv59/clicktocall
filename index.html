<!DOCTYPE html>
<html>
<head>
  <title>Webex Click to Call Test</title>
  <script src="https://unpkg.com/@webex/calling"></script>
</head>
<body>
  <button id="callBtn">Llamar</button>

  <script>
    const jweToken = "YjZmODBmZGUtMGYyYi00NzIzLTk5ZGMtZWYwMjBjNmZjZDU1YmRlZjg3ZTgtODI3_PF84_e8a35262-0627-40d1-9b31-82b6b9af3653"; // quémalo directo por ahora

    async function initCall() {
      const webexConfig = { 
        config: {}, 
        credentials: { access_token: jweToken }
      };

      const callingClientConfig = {
        serviceData: {
          indicator: `guestcalling`,
          guestName: `Invitado`
        },
        jwe: jweToken,
      };

      const callingConfig = {
        callingClientConfig,
      };

      const calling = await Calling.init({ webexConfig, callingConfig });

      calling.on("ready", async () => {
        await calling.register();
        const callingClient = calling.callingClient;
        const line = Object.values(callingClient.getLines())[0];

        line.on('registered', async () => {
          // Creamos el stream de audio local
          const localAudioStream = await Calling.createMicrophoneStream({ audio: true });

          // Creamos la llamada (click-to-call => sin parámetros en makeCall)
          const call = line.makeCall();
          call.dial({ localAudioStream });
        });

        line.register();
      });
    }

    document.getElementById("callBtn").addEventListener("click", initCall);
  </script>
</body>
</html> 
